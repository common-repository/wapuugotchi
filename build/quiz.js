(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,r=window.wp.domReady;var a=e.n(r);const o=window.wp.data,s=(e,t)=>{const r=[];let a="";return e.split(" ").forEach((e=>{a.length+e.length>t?(r.push(a),a=e):a+=" "+e})),r.push(a),r},n=(e,t,r)=>{t.forEach((t=>{const a=i(t,r);e.appendChild(a)}))},i=(e,t)=>{const r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.textContent=e,r.setAttribute("x",t),r.setAttribute("dy","1.2em"),r},c=[{x:0,y:0},{x:320,y:140},{x:-340,y:140}],u=async(e,t)=>{const r=(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg");return g(r),l(r,(e=>{const t=document.createElement("g");return t.id="Cloud--group",e.forEach(((e,r)=>{const a=document.createElement("g");a.classList.add("cloud"),a.setAttribute("transform",`translate(${c[r].x}, ${c[r].y})`),a.innerHTML='\n<path stroke="#000" stroke-width="5" fill="white" fill-rule="evenodd" d="M548.202 44.408a66.593 66.593 0 0 0-52.8 26.283 66.593 66.593 0 0 0-25.598-5.117 66.593 66.593 0 0 0-53.013 26.56 66.593 66.593 0 0 0-1.425-.035 66.593 66.593 0 0 0-66.59 66.593 66.593 66.593 0 0 0 66.588 66.588 66.593 66.593 0 0 0 2.941-.21 106.118 66.593 0 0 0 84.071 25.967 106.118 66.593 0 0 0 86.435-28.167 66.593 66.593 0 0 0 17.436 2.41 66.593 66.593 0 0 0 66.588-66.588 66.593 66.593 0 0 0-60.715-66.319 66.593 66.593 0 0 0-63.918-47.965z"></path>\n<text xml:space="preserve" x="78" y="45" font-family="sans-serif" font-size="12" style="line-height:1.25;text-align:center;white-space:pre;inline-size:111.164" text-anchor="middle" transform="translate(348.776 44.408) scale(2)"></text>';const o=a.querySelector("text"),i=s(e,20);o.setAttribute("y",56-8*i.length);const u=parseInt(o.getAttribute("x"))||0;n(o,i,u),t.append(a)})),t})(t.answers),"g#Front--group"),l(r,(e=>{const t=e,r=document.createElement("g");return r.id="TextBox--group",r.innerHTML='\n<path fill="#fff" stroke="#000" stroke-width="5" d="M80 448.211h500v300H80z"></path>\n<text text-anchor="middle" x="155" y="250" font-family="sans-serif" font-size="14" style="line-height:1.25" transform="scale(2)"></text>\n',n(r.querySelector("text"),t,155),r})(t.question),"g#LeftArm--group"),r.outerHTML},l=(e,t,r)=>{const a=e.querySelector("g#wapuugotchi_type__wapuu, g#wapuugotchi_type__bear");a?.insertBefore(t,e.querySelector(r))},g=e=>{["style","g#Front--group g","g#RightHand--group g","g#BeforeRightHand--part g","g#BeforeLeftArm--part g","g#Ball--group"].forEach((t=>{e.querySelectorAll(t).forEach((e=>e.remove()))}))},d=e=>{const t=e[0],r={question:s(t.question,25),agreement:s(t.correct_notice,25),disagreement:s(t.incorrect_notice,25),answers:[],position:0},{wrongAnswers:a,correctAnswer:o}=t,n=a.sort((()=>Math.random()-.5)).slice(0,2);return n.push(o),r.answers=n.sort((()=>Math.random()-.5)),r.position=r.answers.indexOf(t.correctAnswer),r},p="wapuugotchi/quiz",_=(0,o.createReduxStore)(p,{reducer(e={},t){switch(t.type){case"__SET_STATE":return{...e,...t.payload};case"__SET_AVATAR":return{...e,avatar:t.payload};case"__SET_QUIZ":return{...e,quiz:t.payload};case"__SET_DATA":return{...e,data:[...t.payload]};default:return e}},actions:{__initialize:e=>async({dispatch:t})=>{t.__setState(e);const r=await d(e.data),a=await u(e.avatar,r);t.setQuiz(r),t.setAvatar(a)},__setState:e=>({type:"__SET_STATE",payload:e}),setAvatar:e=>({type:"__SET_AVATAR",payload:e}),setQuiz:e=>({type:"__SET_QUIZ",payload:e}),setData:e=>async({dispatch:t,select:r})=>{const a=await d(r.getData()),o=await u(r.getAvatar(),a);t.setQuiz(a),t.setAvatar(o),t.__setData(e)},__setData:e=>({type:"__SET_DATA",payload:e}),setCompleted:()=>()=>{(0,o.dispatch)("wapuugotchi/mission")?.setCompleted()}},selectors:{__getState:e=>e,getAvatar:e=>e.avatar,getData:e=>e.data,getQuiz:e=>e.quiz}});(0,o.register)(_);const m=window.ReactJSXRuntime;function h(){const e=(0,o.useRegistry)(),{setCompleted:r,setData:a,setAvatar:s}=(0,o.useDispatch)(p),{avatar:i,quiz:c,data:u}=(0,o.useSelect)((e=>({avatar:e(p).getAvatar(),quiz:e(p).getQuiz(),data:e(p).getData()}))),[l,g]=(0,t.useState)(!1),[d,_]=(0,t.useState)(!1),h=(0,t.useCallback)((e=>(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg").innerHTML),[]),y=(0,t.useCallback)((t=>{if(t.target.classList.contains("wapuugotchi_mission__overlay")){const t=document.querySelector("#wapuugotchi_quiz__svg");t.querySelector("g#Cloud--group")?.remove(),t.querySelector("g#TextBox--group")?.remove(),d&&u.shift(),e.batch((()=>{s(t.outerHTML),a(u),_(!1)}))}}),[u,d,e,s,a]),w=(0,t.useCallback)((e=>{const t=document.querySelector("#wapuugotchi_quiz__svg g#Cloud--group"),r=document.querySelector("#wapuugotchi_quiz__svg g#TextBox--group text");t?.remove(),r.querySelectorAll("tspan").forEach((e=>e.remove())),e===c.position?(r.setAttribute("fill","#090"),n(r,c.agreement,155),g(!0)):(r.setAttribute("fill","#900"),n(r,c.disagreement,155),_(!0))}),[c]),v=(0,t.useCallback)((e=>{if("wapuugotchi_quiz__svg"!==e.target.id)return;const t=document.querySelector(".wapuugotchi_mission__overlay");t&&t.click()}),[]);return(0,t.useEffect)((()=>{const e=document.querySelector(".wapuugotchi_mission__overlay"),t=document.querySelector(".wapuugotchi_mission__action");return e.addEventListener("click",y),t.addEventListener("click",(function(t){t.target.classList.contains("wapuugotchi_mission__action")&&(t.stopPropagation(),e.click())})),()=>{e.removeEventListener("click",y)}}),[y]),(0,t.useEffect)((()=>{document.querySelector("#wapuugotchi_quiz__svg g#Cloud--group").querySelectorAll("g.cloud").forEach(((e,t)=>{e.addEventListener("click",(()=>w(t)))})),g(!1)}),[c,w]),(0,t.useEffect)((()=>{const e=document.querySelector("#wapuugotchi_quiz__svg");return e.addEventListener("click",v),()=>{e.removeEventListener("click",v)}}),[v]),(0,t.useEffect)((()=>{l&&r()}),[l,r]),(0,m.jsx)("div",{className:"wapuugotchi_mission__action",children:(0,m.jsx)("svg",{id:"wapuugotchi_quiz__svg",xmlns:"http://www.w3.org/2000/svg",height:"100%",width:"100%",version:"1.1",viewBox:"0 0 1000 1000",dangerouslySetInnerHTML:{__html:h(i)}})})}a()((async()=>{const e=await(async e=>document.querySelector(e)||new Promise((t=>{new MutationObserver(((r,a)=>{const o=document.querySelector(e);o&&(a.disconnect(),t(o))})).observe(document.getElementById("wpbody-content"),{childList:!0,subtree:!0})})))(".wapuugotchi_mission__overlay");(0,t.createRoot)(e).render((0,m.jsx)(t.StrictMode,{children:(0,m.jsx)(h,{})}))}))})();